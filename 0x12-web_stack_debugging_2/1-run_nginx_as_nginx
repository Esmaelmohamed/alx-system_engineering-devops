#!/usr/bin/env bash

# Script to stop Apache2 and configure Nginx to run on port 8080

# Stop any running Apache2 instances (typically running on port 8080)
echo "Stopping Apache2 service..."
service apache2 stop
pkill apache2

# Configure Nginx to listen on port 8080
echo "Configuring Nginx to listen on port 8080..."
CONFIG_LOCATION='/etc/nginx/sites-available/default'
CONFIG="
server {
	listen 8080 default_server;
	listen [::]:8080 default_server ipv6only=on;

	root /usr/share/nginx/html;
	index index.html index.htm;

	server_name localhost;

	location / {
		try_files \$uri \$uri/ =404;
	}
}"
printf "%s" "$CONFIG" > "$CONFIG_LOCATION"

# Ensure Nginx configuration file permissions are correct
echo "Setting permissions for Nginx configuration..."
chown nginx "$CONFIG_LOCATION"
chmod 644 "$CONFIG_LOCATION"

# Restart Nginx to apply the new configuration
echo "Restarting Nginx service..."
service nginx restart

echo "Configuration complete. Nginx is now running on port 8080."

